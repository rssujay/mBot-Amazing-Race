#include <Arduino.h>
#include <Wire.h>
#include <SoftwareSerial.h>

#include <MeMCore.h>		
#define RGBWait 200
#define LDRWait 10


double red;
double green;
double blue;
MeRGBLed rgbled_7(7, 7==7?2:4);
MeLightSensor lightsensor_6(6);

//floats to hold colour arrays
float colourArray[] = {0,0,0};

float greyDiff[] = {0,0,0};


void setup(){

  Serial.begin(9600);
}

void loop(){
  float whiteArray[] = {0,0,0};
  float blackArray[] = {0,0,0};
  //set white balance
  Serial.println("Put White Sample For Calibration ...");
  delay(3000);           //delay for one seconds for getting sample ready
  setBalance(whiteArray);
  
  //set black balance
  Serial.println("Put Black Sample For Calibration ...");
  delay(3000);     //delay for five seconds for getting sample ready 
  setBalance(blackArray);

  Serial.println("WHITE IS");
  Serial.println(whiteArray[0]);
  Serial.println(whiteArray[1]);
  Serial.println(whiteArray[2]);
  Serial.println("BLACK IS");
  Serial.println(blackArray[0]);
  Serial.println(blackArray[1]);
  Serial.println(blackArray[2]);
  //colourAction(red_value, green_value, blue_value);
}

void setBalance(float* colour){
//go through one colour at a time, set the maximum reading for each colour -- red, green and blue to the white array
//shine red
   rgbled_7.setColor(0,255,0,0);
   rgbled_7.show();
   delay(RGBWait);
   colour[0] = lightsensor_6.read();
   rgbled_7.setColor(0,0,0,0); 
   rgbled_7.show();
   delay(RGBWait);
   
   //shine green
   rgbled_7.setColor(0,0,255,0);
   rgbled_7.show();
   delay(RGBWait);
   colour[1] = lightsensor_6.read();
   rgbled_7.setColor(0,0,0,0); 
   rgbled_7.show();
   delay(RGBWait);
   
   //shine blue
   rgbled_7.setColor(0,0,0,255);
   rgbled_7.show();
   delay(RGBWait);
   colour[2] = lightsensor_6.read();
   rgbled_7.setColor(0,0,0,0); 
   rgbled_7.show();
   delay(RGBWait);
}

/**
 * What to do when colour sensor detects a colour
 * Detects RGB values and does challenge
 */
void colourAction(int red, int green, int blue) {
  // scan red
  rgbled_7.setColor(0,255,0,0);
  rgbled_7.show();
  delay(1000);
  red = lightsensor_6.read();
  Serial.print(red);
  Serial.println(" : RED VALUE");

  // scan green
  rgbled_7.setColor(0,0,255,0);
  rgbled_7.show();
  delay(1000);
  green = lightsensor_6.read();
  Serial.print(green);
  Serial.println(" : GREEN VALUE");
  
  // scan blue
  rgbled_7.setColor(0,0,0,255);
  rgbled_7.show();
  delay(1000);
  blue = lightsensor_6.read();
  Serial.print(blue);
  Serial.println(" : BLUE VALUE");

//  Serial.print("THIS IS");
  if (red > 350 && green > 350 && blue > 350) {
    Serial.println(" WHITE");
//      uTurn();
  } else if (red < 200 && green < 200 && blue < 200) {
    Serial.println(" BLACK");
//      stopWheels();
  } else if (blue > red && blue > green) {
      Serial.println(" BLUE");
//      RRTurn();
  } else if (green > red && green > blue) {
    Serial.println(" GREEN");
//      rightTurn();
  } else if (blue + green > 300 && blue + green < 500) {
    Serial.println(" RED");
//      leftTurn();
  } else if (blue + green > 500 && blue + green < 700) {
    Serial.println(" ORANGE");
//      LLTurn();
  }
}
